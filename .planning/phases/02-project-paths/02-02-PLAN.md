---
phase: 02-project-paths
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - part2/camera-game/starter/index.html
  - part2/camera-game/starter/src/main.js
  - part2/camera-game/starter/src/qrScanner.js
  - part2/camera-game/starter/src/multiplayer.js
  - part2/camera-game/starter/src/gameLogic.js
  - part2/camera-game/starter/README.md
  - part2/camera-game/reference/index.html
  - part2/camera-game/reference/src/main.js
  - part2/camera-game/reference/src/qrScanner.js
  - part2/camera-game/reference/src/multiplayer.js
  - part2/camera-game/reference/src/gameLogic.js
  - part2/camera-game/EXTENSIONS.md
  - part2/camera-game/firebase.json
autonomous: true

must_haves:
  truths:
    - "Starter template provides 60-70% complete scaffolding with strategic TODOs"
    - "Reference implementation demonstrates working multiplayer camera-based game"
    - "QR code scanning creates or joins game sessions"
    - "Firebase Realtime Database syncs player state in real-time"
    - "Players can see each other's presence and game state"
    - "Extension challenges guide attendees beyond basic implementation"
  artifacts:
    - path: "part2/camera-game/starter/index.html"
      provides: "HTML with QR scanner container and game UI"
      min_lines: 50
    - path: "part2/camera-game/starter/src/main.js"
      provides: "App initialization and state management (COMPLETE)"
      min_lines: 60
    - path: "part2/camera-game/starter/src/qrScanner.js"
      provides: "html5-qrcode scanner wrapper (COMPLETE)"
      min_lines: 50
    - path: "part2/camera-game/starter/src/multiplayer.js"
      provides: "Firebase Realtime Database connection (COMPLETE)"
      min_lines: 70
    - path: "part2/camera-game/starter/src/gameLogic.js"
      provides: "Game state management (TODO for attendees)"
      min_lines: 60
      contains: "TODO"
    - path: "part2/camera-game/reference/src/gameLogic.js"
      provides: "Complete game logic with scoring and state updates"
      min_lines: 100
    - path: "part2/camera-game/firebase.json"
      provides: "Firebase Emulator configuration"
      contains: "emulators"
  key_links:
    - from: "part2/camera-game/starter/src/main.js"
      to: "src/qrScanner.js"
      via: "QR code triggers session join"
      pattern: "startScanning.*onSessionCodeScanned"
    - from: "part2/camera-game/starter/src/main.js"
      to: "src/multiplayer.js"
      via: "Session code triggers Firebase connection"
      pattern: "joinSession\\(sessionCode\\)"
    - from: "part2/camera-game/starter/src/multiplayer.js"
      to: "Firebase Realtime Database"
      via: "onValue listeners for real-time sync"
      pattern: "onValue.*players"
    - from: "part2/camera-game/starter/src/gameLogic.js"
      to: "src/multiplayer.js"
      via: "Game actions trigger Firebase updates"
      pattern: "updatePlayerState"
---

<objective>
Create camera-based multiplayer game project path (PATH-02) with starter template, reference implementation, and extension challenges.

Purpose: Enable attendees to build Firebase-powered multiplayer QR game in 60-75 minutes by providing complete infrastructure (QR scanning, Firebase connection, presence detection) with strategic TODOs for game logic and state management.

Output: Complete project option with 60-70% scaffolding (starter/), 100% working example (reference/), and guided extensions for fast finishers.
</objective>

<execution_context>
@/home/ahsan/.claude/get-shit-done/workflows/execute-plan.md
@/home/ahsan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-project-paths/02-RESEARCH.md
@.planning/REQUIREMENTS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create starter template with complete infrastructure</name>
  <files>
    part2/camera-game/starter/index.html
    part2/camera-game/starter/src/main.js
    part2/camera-game/starter/src/qrScanner.js
    part2/camera-game/starter/src/multiplayer.js
    part2/camera-game/starter/src/gameLogic.js
    part2/camera-game/starter/README.md
    part2/camera-game/firebase.json
  </files>
  <action>
Create 60-70% complete starter template following research patterns from 02-RESEARCH.md Pattern 2 (Firebase multiplayer) and Pattern 4 (QR scanning).

**index.html:**
- HTML5 boilerplate with viewport meta
- QR scanner container div (id="qr-reader")
- Game UI section (initially hidden):
  - Session code display
  - Player list container (id="players")
  - Score display (id="score")
  - Game action button (id="action-btn")
- Status div for feedback messages
- CDN scripts:
  - Firebase v10: https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js
  - Firebase Database: https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js
  - html5-qrcode: https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js
- ES6 module script loading src/main.js
- Basic CSS: QR scanner 300x300px, game UI grid layout

**src/main.js (COMPLETE - 70 lines):**
- App state object: `{ sessionCode: null, playerId: null, playerName: null, gameState: 'scanning' }`
- Initialize QR scanner on page load
- onSessionCodeScanned(code) callback:
  - Generate unique playerId (crypto.randomUUID or timestamp)
  - Prompt for player name
  - Call joinSession from multiplayer.js
  - Hide QR scanner, show game UI
  - Update session code display
- UI update functions: updatePlayerList(players), updateScore(score)
- Error handling with status messages
- Comment: "// COMPLETE - App initialization and state management ready"

**src/qrScanner.js (COMPLETE - 55 lines):**
- Import Html5QrcodeScanner from CDN
- Export startScanning(onSuccess, onError) function
- Scanner configuration:
  ```javascript
  {
    fps: 10,
    qrbox: { width: 250, height: 250 },
    aspectRatio: 1.0,
    rememberLastUsedCamera: true,
    facingMode: "environment"
  }
  ```
- Render scanner to "qr-reader" div
- onScanSuccess: call callback, clear scanner
- onScanError: log but don't alert (too frequent during scanning)
- Include camera permission feedback
- Comment: "// COMPLETE - QR scanner infrastructure ready"

**src/multiplayer.js (COMPLETE - 80 lines):**
- Firebase config for emulator: `{ databaseURL: "http://127.0.0.1:9000?ns=workshop-demo" }`
- Import initializeApp, getDatabase, ref, set, onValue, onDisconnect, serverTimestamp, push
- Export joinSession(sessionCode, playerId, playerName, onPlayersUpdate):
  - Create player ref: `sessions/${sessionCode}/players/${playerId}`
  - Set player data: `{ name, score: 0, online: true, joinedAt: serverTimestamp() }`
  - Setup presence: `onDisconnect(playerRef).update({ online: false, leftAt: serverTimestamp() })`
  - Listen to all players: `onValue(playersRef, snapshot => onPlayersUpdate(snapshot.val()))`
- Export updatePlayerScore(sessionCode, playerId, newScore):
  - Update score at `sessions/${sessionCode}/players/${playerId}/score`
- Export updateGameState(sessionCode, data):
  - Update game data at `sessions/${sessionCode}/gameData`
- Connection monitoring with `.info/connected`
- Comment: "// COMPLETE - Firebase multiplayer infrastructure ready"

**src/gameLogic.js (TODO - 65 lines with scaffolding):**
- Game state object provided: `{ currentRound: 1, targetScore: 10, gameActive: true }`
- Export initializeGame(sessionCode, playerId) function (COMPLETE - sets up initial state)
- Export onActionButtonClick() function with TODO:
  ```javascript
  // TODO 1: Implement game action (20 minutes)
  // HINT: This is where you define what happens when player presses action button
  // Example ideas:
  // - Increment score when button clicked
  // - Start/stop a timer
  // - Capture photo from camera
  // - Check if player reached target score
  // HINT: Call updatePlayerScore(sessionCode, playerId, newScore) to sync state
  ```
- Export checkWinCondition(players) function with TODO:
  ```javascript
  // TODO 2: Implement win condition (10 minutes)
  // HINT: Check if any player reached targetScore
  // HINT: Return winner object: { playerId, name, score }
  // HINT: Or return null if no winner yet
  ```
- Placeholder: `return null; // Replace with your logic`
- Helper functions provided: getCurrentPlayer(players, playerId), getPlayerRank(players, playerId)

**README.md:**
- Project description: "Multiplayer camera-based game using QR codes and Firebase"
- Learning objectives: QR code scanning, Firebase Realtime Database, multiplayer state sync, presence detection
- Setup:
  1. Install Firebase CLI: `npm install -g firebase-tools`
  2. Start emulator: `firebase emulators:start --only database`
  3. Open index.html in browser
  4. Generate QR code at https://www.qr-code-generator.com (encode session ID like "game-123")
  5. Scan QR code with phone/webcam to join
- Tasks: List TODO 1 (game action - 20 min) and TODO 2 (win condition - 10 min)
- Testing: Open multiple browser tabs/devices, scan same QR, verify player list syncs
- Extension challenges: Reference EXTENSIONS.md
- Time estimate: 60-75 minutes including testing

**firebase.json:**
```json
{
  "emulators": {
    "database": {
      "port": 9000
    },
    "ui": {
      "enabled": true,
      "port": 4000
    }
  }
}
```
  </action>
  <verify>
Check that all 7 files exist and contain expected structure:
- `grep -l "TODO 1" part2/camera-game/starter/src/gameLogic.js`
- `grep -l "TODO 2" part2/camera-game/starter/src/gameLogic.js`
- `grep -l "COMPLETE" part2/camera-game/starter/src/qrScanner.js`
- `grep -l "COMPLETE" part2/camera-game/starter/src/multiplayer.js`
- `grep -l "emulators" part2/camera-game/firebase.json`
- `wc -l part2/camera-game/starter/src/*.js` shows appropriate line counts
  </verify>
  <done>
Starter template exists with complete infrastructure (QR scanning, Firebase connection, presence detection) and 2 strategic TODOs for game action and win condition. Firebase emulator config ready for local testing without production database.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create reference implementation</name>
  <files>
    part2/camera-game/reference/index.html
    part2/camera-game/reference/src/main.js
    part2/camera-game/reference/src/qrScanner.js
    part2/camera-game/reference/src/multiplayer.js
    part2/camera-game/reference/src/gameLogic.js
  </files>
  <action>
Create fully working reference implementation based on research patterns from 02-RESEARCH.md.

**Copy starter infrastructure (index.html, main.js, qrScanner.js, multiplayer.js):**
- Use identical files from starter/ for consistency
- These are already complete

**src/gameLogic.js (COMPLETE - 110 lines):**
Implement simple "Speed Clicker" game where players race to reach target score by clicking action button.

- Game state: `{ currentRound: 1, targetScore: 10, gameActive: true, roundStartTime: null }`
- Import updatePlayerScore, updateGameState from multiplayer.js

**initializeGame(sessionCode, playerId):**
- Set game state in Firebase: `updateGameState(sessionCode, { targetScore: 10, roundStartTime: Date.now() })`
- Initialize player score to 0

**onActionButtonClick():**
```javascript
export function onActionButtonClick() {
  if (!gameState.gameActive) return;

  // Increment local score
  currentScore++;

  // Update Firebase (triggers sync to all players)
  updatePlayerScore(sessionCode, playerId, currentScore);

  // Update local UI
  document.getElementById('score').textContent = `Score: ${currentScore}`;

  // Check if reached target
  if (currentScore >= gameState.targetScore) {
    endGame('You won!');
  }
}
```

**checkWinCondition(players):**
```javascript
export function checkWinCondition(players) {
  if (!players) return null;

  // Find player with score >= targetScore
  for (const [playerId, player] of Object.entries(players)) {
    if (player.score >= gameState.targetScore && player.online) {
      return {
        playerId,
        name: player.name,
        score: player.score,
        timeElapsed: Date.now() - gameState.roundStartTime
      };
    }
  }

  return null;
}
```

**endGame(message):**
- Set gameActive to false
- Show winner message
- Update action button to "Play Again"
- Option to reset scores and start new round

**Additional helper functions:**
- getRankedPlayers(players): Sort by score descending
- formatTime(ms): Convert milliseconds to MM:SS format
- resetGame(): Clear scores, start new round

Include comments explaining:
- Last-write-wins pattern (no transaction needed for score updates)
- Presence detection via onDisconnect
- Real-time sync via onValue listeners
- Game state denormalization for performance
  </action>
  <verify>
Check reference implementation is complete:
- `grep -c "TODO" part2/camera-game/reference/src/*.js` returns 0 (no TODOs)
- `grep -l "onActionButtonClick" part2/camera-game/reference/src/gameLogic.js`
- `grep -l "checkWinCondition" part2/camera-game/reference/src/gameLogic.js`
- `grep -l "updatePlayerScore" part2/camera-game/reference/src/gameLogic.js`
- `grep -l "Last-write-wins" part2/camera-game/reference/src/gameLogic.js` (comment exists)
  </verify>
  <done>
Reference implementation exists with complete game logic (speed clicker with scoring, win detection, player ranking) and Firebase real-time sync. Opening index.html in multiple tabs and scanning same QR shows synchronized player list and scores.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create extension challenges document</name>
  <files>
    part2/camera-game/EXTENSIONS.md
  </files>
  <action>
Create extension challenges for fast finishers, organized by difficulty and estimated time.

**Structure:**

# Camera-Based Multiplayer Game - Extension Challenges

## Overview
Completed the basic multiplayer game? Here are ways to extend your project.

## Beginner Extensions (10-15 minutes each)

### 1. Player Count Display
- **Challenge:** Show "X players online" in UI
- **Hint:** Count players where online === true
- **Learning:** Object filtering, UI updates

### 2. Color-Coded Scores
- **Challenge:** Highlight leading player in green, trailing in red
- **Hint:** Add CSS classes based on player rank
- **Learning:** Dynamic styling, rankings

### 3. Sound Effects
- **Challenge:** Play sound when score updates or player joins
- **Hint:** Use Web Audio API or HTML5 `<audio>` element
- **Learning:** Audio integration, event-driven sounds

## Intermediate Extensions (20-30 minutes each)

### 4. Countdown Timer
- **Challenge:** Add 60-second timer, end game when time expires
- **Hint:** Store startTime in Firebase, calculate remaining time client-side
- **Learning:** Time synchronization, countdown logic

### 5. QR Code Generation
- **Challenge:** Generate QR code for session instead of using external tool
- **Hint:** Use qrcode.js library, display canvas with session code
- **Learning:** QR code generation, canvas API

### 6. Player Avatars
- **Challenge:** Let players choose emoji or color as avatar
- **Hint:** Add avatar field to player data, display in player list
- **Learning:** User customization, Firebase data structure

### 7. Round System
- **Challenge:** Support multiple rounds with score reset
- **Hint:** Track roundNumber in gameData, reset scores between rounds
- **Learning:** Game state management, round lifecycle

## Advanced Extensions (45+ minutes each)

### 8. Camera Selfie Challenge
- **Challenge:** Players take selfie when button clicked instead of just clicking
- **Hint:** Use getUserMedia to capture photo, store as data URL
- **Learning:** Camera API, image capture, data URLs

### 9. Leaderboard Persistence
- **Challenge:** Store high scores across sessions
- **Hint:** Write to /leaderboard/{timestamp} with player name and score
- **Learning:** Data persistence, leaderboard design

### 10. Spectator Mode
- **Challenge:** Allow non-playing users to watch game in real-time
- **Hint:** Create /spectators/{spectatorId} path, read-only access to game state
- **Learning:** Different user roles, read-only connections

### 11. Team Mode
- **Challenge:** Support 2 teams competing for combined score
- **Hint:** Add teamId field, aggregate scores by team
- **Learning:** Team mechanics, data aggregation

## Performance Challenges

### 12. Offline Support
- **Challenge:** Continue playing when internet drops, sync when reconnected
- **Hint:** Use Firebase offline persistence, queue actions locally
- **Learning:** Offline-first design, sync strategies

### 13. Rate Limiting
- **Challenge:** Prevent spam clicking (max 1 click per second)
- **Hint:** Track lastClickTime, reject clicks within cooldown
- **Learning:** Rate limiting, anti-cheat mechanisms

## Creative Challenges

### 14. Custom Game Modes
- **Challenge:** Add different game types (longest word, math quiz, reaction time)
- **Hint:** Store gameMode in session, switch logic based on mode
- **Learning:** Game mode architecture, extensibility

### 15. Emoji Reactions
- **Challenge:** Players can send emoji reactions that appear on others' screens
- **Hint:** Write to /sessions/{sessionId}/reactions, listen and animate
- **Learning:** Event broadcasting, animations

### 16. Power-ups
- **Challenge:** Add power-ups (2x points, freeze opponents, etc.)
- **Hint:** Store powerUp state per player, apply effects in game logic
- **Learning:** Game mechanics, status effects

## Firebase-Specific Challenges

### 17. Security Rules
- **Challenge:** Add Firebase security rules to prevent cheating
- **Hint:** Use `.validate` to enforce score limits, `.write` rules for ownership
- **Learning:** Firebase security, server-side validation

### 18. Presence Heartbeat
- **Challenge:** Improve presence detection with periodic heartbeats
- **Hint:** Write timestamp every 5 seconds, consider offline if > 10 seconds old
- **Learning:** Presence patterns, heartbeat mechanisms

## Documentation Challenge

### 19. Write a Tutorial
- **Challenge:** Document your game mechanics for other developers
- **Hint:** Include game flow diagram, data structure, deployment steps
- **Learning:** Technical writing, architecture documentation

---

**Bonus:** Combine extensions to create unique game experiences! Example: Camera selfie + Emoji reactions + Round system = Photo-based party game.

**Share:** Deploy your extended version to Firebase Hosting and share the URL!
  </action>
  <verify>
Check EXTENSIONS.md exists and contains challenges:
- `grep -c "Challenge:" part2/camera-game/EXTENSIONS.md` returns at least 19
- `grep -l "Beginner.*Intermediate.*Advanced" part2/camera-game/EXTENSIONS.md`
- `wc -l part2/camera-game/EXTENSIONS.md` shows substantial content (200+ lines)
  </verify>
  <done>
Extension challenges document exists with 19 challenges spanning beginner to advanced levels, including Firebase-specific and creative game mechanics. Fast finishers have clear next steps beyond basic implementation.
  </done>
</task>

</tasks>

<verification>
Camera-based game project path complete when:
- [ ] Starter template exists with 60-70% scaffolding (complete infrastructure + 2 TODOs)
- [ ] Reference implementation exists with 100% working code (no TODOs)
- [ ] Extension challenges document exists with 19+ challenges at multiple difficulty levels
- [ ] Firebase emulator configuration is ready (firebase.json)
- [ ] Starter README.md provides clear setup including emulator instructions
- [ ] QR scanning integration matches research patterns from 02-RESEARCH.md
- [ ] Firebase Realtime Database integration uses presence detection and onDisconnect
- [ ] Multiplayer state sync uses last-write-wins pattern (no transactions for simplicity)
</verification>

<success_criteria>
PATH-02 requirement met when:
1. Starting Firebase emulator with `firebase emulators:start --only database` succeeds
2. Opening starter/index.html shows QR scanner interface
3. Starter template has exactly 2 TODO sections with clear hints and time estimates (20 min + 10 min)
4. Opening reference/index.html in multiple browser tabs and scanning same QR code shows synchronized player list
5. Clicking action button in reference implementation increments score visible to all players in real-time
6. EXTENSIONS.md provides at least 15 additional challenges for attendees who finish early
7. Project can be completed within 60-75 minutes based on TODO time estimates (20 + 10 = 30 min implementation, 30-45 min for setup, exploration, and testing)
</success_criteria>

<output>
After completion, create `.planning/phases/02-project-paths/02-02-SUMMARY.md`
</output>
